<!DOCTYPE html>
<html>
	<head>
		<script src="https://code.jquery.com/jquery-3.3.1.min.js"   
				integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
				crossorigin="anonymous">
		</script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
				integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" 
				crossorigin="anonymous">
		</script>
		<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" 
			  rel="stylesheet" 
			  integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" 
			  crossorigin="anonymous">
		<title>
			IT202 Week 5 Lab - Search for towed vehicles.
		</title>
		<style type="text/css">
			#error_msg {
				color: red;
			}
			.hidden {
				display: none;
			}
			.formInput {
				width: 100px;
			}
		</style>
	</head>
	<body>
		<h2>Please fill out form below to find towed vehicle:</h2>
		<br>
		<form id="vehicle_search_form">
			<input id="v_make" name="make" placeholder="Car make" class="formInput">
			<select id="v_color" name="color">
				<option value="any" selected="selected">Select Color</option>
				<option value="BGE">Beige</option>
				<option value="BLK">Black</option>
				<option value="BLU">Blue</option>
				<option value="BRZ">Bronze</option>
				<option value="BRO">Brown</option>
				<option value="MAR">Burgundy</option>
				<option value="COM">Chome</option>
				<option value="CPR">Copper</option>
				<option value="DBL">Dark Blue</option>
				<option value="DGR">Dark Green</option>
				<option value="GLD">Gold</option>
				<option value="GRN">Green</option>
				<option value="GRY">Grey</option>
				<option value="CRM">Ivory</option>
				<option value="LAV">Lavender</option>
				<option value="LBL">Light Blue</option>
				<option value="LGR">Light Grey</option>
				<option value="ONG">Orange</option>
				<option value="PNK">Pink</option>
				<option value="PLE">Purple</option>
				<option value="RED">Red</option>
				<option value="SIL">Silver</option>
				<option value="TAN">Tan</option>
				<option value="TRQ">Turquoise</option>
				<option value="WHI">White</option>
				<option value="YEL">Yellow</option>
			</select>
			<input id="v_plate" name="plate" type="text" placeholder="Plate #" class="formInput">
			<select id="v_state" name="state">
				<option value="any" selected="selected">Select State</option>
				<option value="AL">Alabama</option>
				<option value="AK">Alaska</option>
				<option value="AZ">Arizona</option>
				<option value="AR">Arkansas</option>
				<option value="CA">California</option>
				<option value="CO">Colorado</option>
				<option value="CT">Connecticut</option>
				<option value="DE">Delaware</option>
				<option value="DC">District Of Columbia</option>
				<option value="FL">Florida</option>
				<option value="GA">Georgia</option>
				<option value="HI">Hawaii</option>
				<option value="ID">Idaho</option>
				<option value="IL">Illinois</option>
				<option value="IN">Indiana</option>
				<option value="IA">Iowa</option>
				<option value="KS">Kansas</option>
				<option value="KY">Kentucky</option>
				<option value="LA">Louisiana</option>
				<option value="ME">Maine</option>
				<option value="MD">Maryland</option>
				<option value="MA">Massachusetts</option>
				<option value="MI">Michigan</option>
				<option value="MN">Minnesota</option>
				<option value="MS">Mississippi</option>
				<option value="MO">Missouri</option>
				<option value="MT">Montana</option>
				<option value="NE">Nebraska</option>
				<option value="NV">Nevada</option>
				<option value="NH">New Hampshire</option>
				<option value="NJ">New Jersey</option>
				<option value="NM">New Mexico</option>
				<option value="NY">New York</option>
				<option value="NC">North Carolina</option>
				<option value="ND">North Dakota</option>
				<option value="OH">Ohio</option>
				<option value="OK">Oklahoma</option>
				<option value="OR">Oregon</option>
				<option value="PA">Pennsylvania</option>
				<option value="RI">Rhode Island</option>
				<option value="SC">South Carolina</option>
				<option value="SD">South Dakota</option>
				<option value="TN">Tennessee</option>
				<option value="TX">Texas</option>
				<option value="UT">Utah</option>
				<option value="VT">Vermont</option>
				<option value="VA">Virginia</option>
				<option value="WA">Washington</option>
				<option value="WV">West Virginia</option>
				<option value="WI">Wisconsin</option>
				<option value="WY">Wyoming</option>
			</select>
			<button id="v_search">Search</button>
		</form>
		<div id="error_msg"></div>
		<div>* Car make is 4 character abbreviation. EX: Honda - HOND, Toyota - TOYT etc.</div>
		<br>
		<div id="search_result_container" class="hidden">
			<table id="result_table" class="table table-striped">
				<thead class="thead-dark">
				  <tr>
					<th scope="col">#</th>
					<th scope="col">Tow Date</th>
					<th scope="col">Make #</th>
					<th scope="col">Style</th>
					<th scope="col">Model</th>
					<th scope="col">Color</th>
					<th scope="col">Plate</th>
					<th scope="col">State</th>
					<th scope="col">Towed to address</th>
					<th scope="col">Facility Phone #</th>
					<th scope="col">Inventory #</th>
				  </tr>
				</thead>
				<tbody>
				</tbody>
			  </table>
		</div>
		<script type="text/javascript">
			$(document).ready(function() {
				// Add "Search" button even listener:
				$("#vehicle_search_form").on("submit", function(e) {
					var urlString = "https://data.cityofchicago.org/resource/rp42-fxjt.json?";
					// Check user input:
					if ($("#v_make").val().length > 0) {
						urlString += "make="+ $("#v_make").val().toUpperCase() + "&";
					}
					if ($("#v_color").val() != "any") {
						urlString += "color="+ $("#v_color").val().toUpperCase()+ "&";
					}
					if ($("#v_plate").val().length > 0) {
						urlString += "plate="+ $("#v_plate").val().toUpperCase() + "&";
					}
					if ($("#v_state").val() != "any") {
						urlString += "state="+ $("#v_state").val().toUpperCase();
					}
					$.get(urlString).done(function(data){
						$("#search_result_container").removeClass("hidden");
						$("#result_table tbody").html("<tr></tr>");
						if (data.length == 0) {
							var row = "<tr><td colspan=\"11\" align=\"center\">NO CARS HAVE BEEN FOUND</td></tr>";
							$("#result_table tbody tr:last").after(row);
							return;
						}
						$.each(data, function(i, v) {
							var row = "<tr><th scope=\"row\">" + (i + 1) + "</th>" +
							          "<td>" + v.tow_date.substring(0,10) + "</td>" +
									  "<td>" + v.make + "</td>" +
									  "<td>" + v.style + "</td>" +
									  "<td>" + v.model + "</td>" +
									  "<td>" + v.color + "</td>" +
									  "<td>" + v.plate + "</td>" +
									  "<td>" + v.state + "</td>" +
									  "<td>" + v.towed_to_address.trim() + "</td>" +
									  "<td>" + v.tow_facility_phone + "</td>" +
									  "<td>" + v.inventory_number + "</td>" +
							          "</tr>";
							$("#result_table tbody tr:last").after(row);
						});
						
					});
					e.preventDefault();
				});
			});
		</script>
	</body>
</html>